package com.e3ps.common.util;

import com.e3ps.change.EChangeOrder2;
import com.e3ps.change.EChangeRequest2;
import com.e3ps.common.jdf.config.ConfigImpl;
import com.e3ps.distribute.DistributeDocument;
import com.e3ps.distribute.DistributeRegistration;
import com.e3ps.doc.E3PSDocument;
import com.e3ps.project.EProject;

import wt.access.AccessControlHelper;
import wt.access.AccessPermission;
import wt.admin.AdminDomainRef;
import wt.admin.AdministrativeDomain;
import wt.admin.AdministrativeDomainHelper;
import wt.epm.EPMDocument;
import wt.inf.container.WTContainerHelper;
import wt.inf.container.WTContainerRef;
import wt.org.WTPrincipal;
import wt.part.WTPart;
import wt.session.SessionHelper;

public class AccessControlUtil {
	
	private AccessControlUtil() {}
	
	public static boolean checkPermissionForObject(Class class1) throws Exception {
		
		WTPrincipal sessionUser = SessionHelper.getPrincipal();
		String orgName = ConfigImpl.getInstance().getString("org.context.name");
		String productName = ConfigImpl.getInstance().getString("product.context.name");
		String targetObject = "WCTYPE|" + class1.getName();
		WTContainerRef container_ref = WTContainerHelper.service.getByPath("/wt.inf.container.OrgContainer="+orgName+"/wt.pdmlink.PDMLinkProduct="+productName);
		AdministrativeDomain domain = AdministrativeDomainHelper.manager.getDomain("/Default", container_ref);
    	AdminDomainRef doaminref = AdminDomainRef.newAdminDomainRef(domain);
    	
		return AccessControlHelper.manager.hasAccess(sessionUser, targetObject, doaminref, null, AccessPermission.READ);
	}
	
	public static boolean checkPermissionForObject(String className) throws Exception {
		String targetObject = "WCTYPE|";
		switch (className) {
		case "doc":
			targetObject += E3PSDocument.class.getName();
			break;
		case "part":
			targetObject += WTPart.class.getName();
			break;
		case "epm":
			targetObject += EPMDocument.class.getName();
			break;
		case "ecr":
			targetObject += EChangeRequest2.class.getName();
			break;
		case "eco":
			targetObject += EChangeOrder2.class.getName();
			break;
		case "project":
			targetObject += EProject.class.getName();
			break;
		case "distdoc":
			targetObject += DistributeDocument.class.getName();
			break;
		case "distreg":
			targetObject += DistributeRegistration.class.getName();
			break;	
		default:
			targetObject += E3PSDocument.class.getName();
			break;
		}
		
		
		WTPrincipal sessionUser = SessionHelper.getPrincipal();
		String orgName = ConfigImpl.getInstance().getString("org.context.name");
		String productName = ConfigImpl.getInstance().getString("product.context.name");
		WTContainerRef container_ref = WTContainerHelper.service.getByPath("/wt.inf.container.OrgContainer="+orgName+"/wt.pdmlink.PDMLinkProduct="+productName);
		AdministrativeDomain domain = AdministrativeDomainHelper.manager.getDomain("/Default", container_ref);
    	AdminDomainRef doaminref = AdminDomainRef.newAdminDomainRef(domain);
    	
		return AccessControlHelper.manager.hasAccess(sessionUser, targetObject, doaminref, null, AccessPermission.READ);
	}
	
}
